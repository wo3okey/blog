{"componentChunkName":"component---src-templates-post-jsx","path":"/srping-aop/","result":{"data":{"site":{"siteMetadata":{"title":"wookey-devlog"}},"markdownRemark":{"id":"12484624-47ce-513a-b74f-0e699c275f52","excerpt":"AOP AOP(Aspect Oriented Programming)는 컴퓨터 패러다임의 일종으로, 관점 지향 프로그래밍이라 불린다. 이러한 AOP의 메커니즘은 프로그램을 관심사(Concerns) 기준으로 크게 핵심 관심사와 횡단 관심사로 분류한다.  핵심 관심사는 해당 프로그램의 핵심적인 기능, 즉 비즈니스 로직을 뜻한다. 그에 빈해 횡단 관심사는 보안, …","html":"<h2>AOP</h2>\n<p>AOP(Aspect Oriented Programming)는 컴퓨터 패러다임의 일종으로, 관점 지향 프로그래밍이라 불린다. 이러한 AOP의 메커니즘은 프로그램을 관심사(Concerns) 기준으로 크게 핵심 관심사와 횡단 관심사로 분류한다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/280a2aa9aa70730bcb882e914e1abdfc/b4ad3/spring-aop-01.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 46.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrklEQVR42pWR30uTcRTGB/4f3gtedCPpLoqxi1IINS/6QbyGytReIrUcoWaaDhULYVo6VIRKgnkh4oXITPBCt4oYTugmRitXLJlzugmv+/rdx71uo4W70AcOh8N5+PAcjsGQElCgdymlg7REOHLI1q8YfpebsKIQ6ugm1NbOjvqQYHcfoXuK2NlL6F5HLsOQO+jLNO9YzH/8Tm2Pi3r1LdbLtajmVpqNFppK7qOUNXK3sEKovQtoQp4CnU7nP2B2iEajGaAU694gA++8jPTPMVtaxfSNB0yZFSav3MZebmGsyCwmPnxGSDJAzgL9fr9jf//g9OTl9R9Yxzbo6HIyaGrgeaWVZ9dUukwWnlx/REvxTfHi9SpaQp4F5jt5xRPg8aibnqfvmblUjt1ch914C3tJNQNXFYYLjWLQsZY/Yb6neDb/MLXwjTfjLl5VtfKyzsbQnU5sNe3YlF46TQ1idtF33oSITOc4HuPv2irRTS/hT24iXzyEvV8JLC1mPef5MiKZTCJlujQhOExVPJFIlSASi/N7N3IxYDahDtYV3N5my+fjZyDAkablev4DngAlJsRWElaxUAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='spring aop 01' title='' src='/static/280a2aa9aa70730bcb882e914e1abdfc/ca1dc/spring-aop-01.png' srcset='/static/280a2aa9aa70730bcb882e914e1abdfc/e7570/spring-aop-01.png 170w,\n/static/280a2aa9aa70730bcb882e914e1abdfc/f46e7/spring-aop-01.png 340w,\n/static/280a2aa9aa70730bcb882e914e1abdfc/ca1dc/spring-aop-01.png 680w,\n/static/280a2aa9aa70730bcb882e914e1abdfc/02d09/spring-aop-01.png 1020w,\n/static/280a2aa9aa70730bcb882e914e1abdfc/b4ad3/spring-aop-01.png 1080w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>핵심 관심사는 해당 프로그램의 핵심적인 기능, 즉 비즈니스 로직을 뜻한다. 그에 빈해 횡단 관심사는 보안, 프로파일링, 로그, 트랜잭션은 비즈니스 기능은 아니지만, 요구 상황에 따라서 다수의 비즈니스 기능에 포함되며, 비즈니스 로직과는 다른 관심의 영역을 뜻한다. 여담으로 핵심 관심사를 모듈화 한것을 OOP, 부가적인 횡단 관심사를 모듈화 한것들 AOP라고 표현할 수 있을것 같다.</p>\n<h3>관련 용어</h3>\n<ul>\n<li>Target: 어떤 대상에 부가 기능을 부여할 것인지</li>\n<li>Advice: 어떤 부가 기능을 부여할 것인지</li>\n<li>Join Point: 어디에 적용할 것인지</li>\n<li>Point Cut: 실제 Advice가 적용될 시점을 의미. Spring AOP에서는 advice가 적용될 메서드를 선정.</li>\n</ul>\n<h3>@Transactional</h3>\n<p>트랜잭션 처리를 위해 아래와같은 트랜잭션 처리 동작 코드를 작성할 수 있다. </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TransactionProxy</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">TransactonManager</span> manager <span class=\"token operator\">=</span> <span class=\"token class-name\">TransactionManager</span><span class=\"token punctuation\">.</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">transaction</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            manager<span class=\"token punctuation\">.</span><span class=\"token function\">begin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            target<span class=\"token punctuation\">.</span><span class=\"token function\">logic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 비즈니스 로직(target)</span>\n\n            manager<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Exception</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            manager<span class=\"token punctuation\">.</span><span class=\"token function\">rollback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>하지만 모든 트랜잭션 처리 코드에 이와 같은 로직을 작성하게 되면, 비즈니스 로직에 집중이 되지 않고 중복적인 코드를 발생시키게 된다. 그래서 spring에서는 트랜잭션 처리 로직을 횡단으로 적용할 수 있도록 <code class=\"language-text\">@Transactional</code> AOP Proxy를 지원한다.</p>\n<h2>AOP Proxy</h2>\n<p>spring AOP에는 JDK Proxy, CGLib Proxy의 두가지 방법이 있다. 두 방식의 가장 핵심적인 차이는 인터페이스의 유무이다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/327e1a3154456fa56b6b2ed100f13cbe/b4ad3/spring-aop-02.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 46.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABSklEQVR42o2RzYrCQBCEBV9RfJccfQ8hl3gQ8aAHIZhrQBBREC/+gwcNIYmaxP+2dmqIu8JmFweKhumZb6qmCwCKBbVULd9uN+z3e0mSBGEYIooirSAI8Hw+kbMkq+WMUSy8A9k5Ho8aeL/ff26J4PF4sIc4jpGmqd77CLjdbmU6ncLzPJzPZ32azgnwfR/r9RqbzUaDPwLyEN0sl0sQrB7Qbl+RT6eT7s3nc8xmM6Hbf4HKjdCZbdtoNptwXRfX6/UbyL/tdrvodDpotVpCt7lA5UoDlRthHAIYk/UdyPqSZB/Ju7kOVQRUq1VZrVbo9/sYjUYYj8c4HA4aRteNRoNR0ev1MBgMZLFY8MF8YLvdRqlUkslkglqtplWv17Hb7TSwUqnAMAwMh0OYpgnLssRxHA7o7z+8XC56KBwEp0u9InOfYtJMvyJ/AXfDRQLOIReZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='spring aop 02' title='' src='/static/327e1a3154456fa56b6b2ed100f13cbe/ca1dc/spring-aop-02.png' srcset='/static/327e1a3154456fa56b6b2ed100f13cbe/e7570/spring-aop-02.png 170w,\n/static/327e1a3154456fa56b6b2ed100f13cbe/f46e7/spring-aop-02.png 340w,\n/static/327e1a3154456fa56b6b2ed100f13cbe/ca1dc/spring-aop-02.png 680w,\n/static/327e1a3154456fa56b6b2ed100f13cbe/02d09/spring-aop-02.png 1020w,\n/static/327e1a3154456fa56b6b2ed100f13cbe/b4ad3/spring-aop-02.png 1080w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<h3>JDK Proxy</h3>\n<p>JDK Proxy의 경우 AOP를 적용하여 구현된 클래스의 인터페이스를 프록시 객체로 구현해서 코드를 끼워넣는 방식이다.</p>\n<ul>\n<li>Relfection API을 사용해 느리다.</li>\n<li>인터페이스가 반드시 필요하다.</li>\n</ul>\n<h3>CGLIB</h3>\n<p>CGLib은 Code Generator Library의 약자로, 클래스의 바이트코드를 조작하여 Proxy 객체를 생성해주는 라이브러리이다. springboot2 부터는 외부 라이브러리가 아닌, core 모듈에 기본 탑제 되어있다.</p>\n<ul>\n<li>바이트 코드를 조작해서 빠르다.</li>\n<li>클래스만 있어도 작동한다.</li>\n<li>상속을 이용해서 프록시를 생성하기 때문에, 당연하게도 메서드에 final, private를 붙이면 안된다.</li>\n</ul>\n<h2>결론</h2>\n<p>spring AOP는 사용자의 특정 호출 시점에 IoC 컨테이너에 의해 AOP를 할 수 있는 Proxy Bean을 생성해준다. 이는 동적으로 생성된 Proxy Bean의 타겟 메소드가 호출되는 시점에 부가적인 기능을 추가할 메소드를 주입해준다. </p>\n<blockquote>\n<p>AOP Proxy의 런타임 위빙(Weaving)을 통해 개발자는 불필요한 횡단 로직을 간결화 하고 AOP Proxy에 의해 비즈니스 모듈에 집중하는 코드를 개발할 수 있다.</p>\n</blockquote>","frontmatter":{"title":"spring AOP의 proxy","date":"October 07, 2023","update":"October 07, 2023","tags":["spring","aop","proxy"],"series":"spring"},"fields":{"slug":"/srping-aop/","readingTime":{"minutes":4.19}}},"seriesList":{"edges":[{"node":{"id":"da7bb81c-8024-55a1-a172-21b5d4193cf0","fields":{"slug":"/spring-transactional/"},"frontmatter":{"title":"spring @Transactional 조금더 알아보기"}}},{"node":{"id":"0f7d0451-d8d6-57f3-b8ad-ab49d52a1da8","fields":{"slug":"/servelt/"},"frontmatter":{"title":"spring servelt은 무엇인가?"}}},{"node":{"id":"12484624-47ce-513a-b74f-0e699c275f52","fields":{"slug":"/srping-aop/"},"frontmatter":{"title":"spring AOP의 proxy"}}}]},"previous":{"fields":{"slug":"/proxy/"},"frontmatter":{"title":"간단 nginx proxy 정리"}},"next":null},"pageContext":{"id":"12484624-47ce-513a-b74f-0e699c275f52","series":"spring","previousPostId":"cd427022-3331-5f4a-8322-79f6180f37c0","nextPostId":null}},"staticQueryHashes":[],"slicesMap":{}}